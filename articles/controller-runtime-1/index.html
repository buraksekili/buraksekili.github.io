<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Diving into controller-runtime | Manager | Burak Sekili</title>
<meta name=keywords content="Kubernetes,Operator,controller-runtime"><meta name=description content="Introduction to the Manager in `controller-runtime`"><meta name=author content="Burak Sekili"><link rel=canonical href=https://buraksekili.github.io/articles/controller-runtime-1/><link crossorigin=anonymous href=/assets/css/stylesheet.7726002848dbac51340fdf1f6cd23eced5d647fd12bcb5e85c5c43d1227ec57e.css integrity="sha256-dyYAKEjbrFE0D98fbNI+ztXWR/0SvLXoXFxD0SJ+xX4=" rel="preload stylesheet" as=style><link rel=stylesheet href=css/extended/custom.css><link rel=icon href=https://buraksekili.github.io/images/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://buraksekili.github.io/images/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://buraksekili.github.io/images/favicon-32x32.png><link rel=apple-touch-icon href=https://buraksekili.github.io/images/apple-touch-icon.png><link rel=mask-icon href=https://buraksekili.github.io/images/apple-touch-icon.png><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script async src="https://www.googletagmanager.com/gtag/js?id=G-M6ZJTX7HVG"></script><script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-M6ZJTX7HVG",{anonymize_ip:!1})}</script><meta property="og:title" content="Diving into controller-runtime | Manager"><meta property="og:description" content="Introduction to the Manager in `controller-runtime`"><meta property="og:type" content="article"><meta property="og:url" content="https://buraksekili.github.io/articles/controller-runtime-1/"><meta property="article:section" content="articles"><meta property="article:published_time" content="2023-11-02T00:00:00+00:00"><meta property="article:modified_time" content="2023-11-02T00:00:00+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Diving into controller-runtime | Manager"><meta name=twitter:description content="Introduction to the Manager in `controller-runtime`"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Articles","item":"https://buraksekili.github.io/articles/"},{"@type":"ListItem","position":2,"name":"Diving into controller-runtime | Manager","item":"https://buraksekili.github.io/articles/controller-runtime-1/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Diving into controller-runtime | Manager","name":"Diving into controller-runtime | Manager","description":"Introduction to the Manager in `controller-runtime`","keywords":["Kubernetes","Operator","controller-runtime"],"articleBody":"Introduction The controller-runtime package has become a fundamental tool for most Kubernetes controllers, simplifying the creation of controllers to manage resources within a Kubernetes environment efficiently. Users tend to prefer it over client-go.\nThe increased adoption of projects like Kubebuilder or Operator SDK has facilitated the creation of Kubernetes Operator projects. Users need to implement minimal requirements to start with Kubernetes controllers, thanks to these projects.\nAs a developer working on Kubernetes projects, I inevitably touch code pieces utilizing controller-runtime. Whenever I dive into code base, I always learn something new about the underlying mechanism of Kubernetes.\nThrough this blog series, I aim to share my learning regarding controller-runtime, consolidating my notes spread across various notebooks.\nThis article will specifically delve into the role of controller-runtime’s Manager.\nWhat are Controllers and Operators? controller-runtime has emerged as the go-to package for building Kubernetes controllers. However, it is essential to understand what these controllers - or Kubernetes Operators - are.\nIn Kubernetes, controllers observe resources, such as Deployments, in a control loop to ensure the cluster resources conform to the desired state specified in the resource specification (e.g., YAML files) 1.\nOn the other hand, according to Redhat, a Kubernetes Operator is an application-specific controller 2. For instance, the Prometheus Operator manages the lifecycle of a Prometheus instance in the cluster, including managing configurations and updating Kubernetes resources, such as ConfigMaps.\nRoughly both are quite similar. They provide a control loop to ensure the current state meets the desired state.\nThe Architecture of Controllers Since controllers are in charge of meeting the desired state of the resources in Kubernetes, they somehow need to be informed about the changes on the resources and perform certain operations if needed. For this, controllers follow a special architecture to\nobserve the resources, inform any events (updating, deleting, adding) done on the resources, keep a local cache to decrease the load on API Server, keep a work queue to pick up events, run workers to perform reconciliation on resources picked up from work queue. This architecture is clearly pictured in client-go documentation: reference: client-go documentation 3\nMost end-users typically do not need to interact with the sections outlined in blue in the architecture. The controller-runtime effectively manages these elements. The subsequent section will explain these components in simple terms.\nTo simply put, controllers use\ncache to prevent sending each getter request to API server, workqueue which includes the key of the object that needs to be reconciled, workers to process items reconciliation. Informer Informers watch Kubernetes API server to detect changes in resources that we want to. It keeps a local cache - in-memory cache implementing Store interface - including the objects observed through Kubernetes API. Then controllers and operators use this cache for all getter requests - GET and LIST - to prevent load on Kubernetes API server. Moreover, Informers invoke controllers by sending objects to the controllers (registering Event Handlers).\nInformers leverage certain components like Reflector, Queue and Indexer, as shown in the above diagram.\nReflector According to godocs:\nReflector watches a specified resource and causes all changes to be reflected in the given store.\nThe store is actually a cache - with two options; simple one and FIFO. Reflector pushes objects to Delta Fifo queue.\nBy monitoring the server (Kubernetes API Server), the Reflector maintains a local cache of the resources. Upon any event occurring on the watched resource, implying a new operation on the Kubernetes resource, the Reflector updates the cache (Delta FIFO queue, as illustrated in the diagram). Subsequently, the Informer reads objects from this Delta FIFO queue, indexes them for future retrievals, and dispatches the object to the controller.\nIndexer Indexer saves objects into thread-safe Store by indexing the objects. This approach facilitates efficient querying of objects from the cache.\nCustom indexers, based on specific needs, can be created. For example, a custom indexer can be generated to retrieve all objects based on certain fields, such as Annotations.\nManager According to godocs\nmanager is required to create controllers and provides shared dependencies such as clients, caches, schemes, etc. Controllers must be started by calling Manager.Start.\nThe Manager serves as a crucial component for controllers by managing their operations. To put it simply, the manager oversees one or more controllers that watch the resources (e.g., Pods) of interest.\nEach operator requires a Manager to operate, as the Manager controls the controllers, webhooks, metric servers, logs, leader elections, caches, and other components.\nFor all dependencies managed by the Manager, please refer to the [Manager interface](https://pkg.go.dev/sigs.k8s.io/controller-runtime/pkg/manager#\nController Dependencies As godocs mentioned, Manager provides shared dependencies such as clients, caches, schemes etc. These dependencies are shared among the controllers managed by the Manager. If you have registered two controllers with the Manager, these controllers will share common resources.\nReconciliation, or the reconcile loop, involves the operators or controllers executing the business logic for the watched resources. For example, a Deployment controller might create a specific number of Pods as specified in the Deployment spec.\nThe Client package exposes functionalities to communicate with the Kubernetes API 4. Controllers, registered with a specific Manager, utilize the same client to interact with the Kubernetes API. The main operations of the client include reading and writing.\nReading operations mostly utilize the cache to access the Kubernetes API, rather than accessing it directly, to reduce the load on the Kubernetes API. In contrast, write operations directly communicate with the Kubernetes API. However, this behavior can be modified so that read requests are directed to the Kubernetes API. Nevertheless, this is generally not recommended unless there is a compelling reason to do so.\nThe cache is also shared across controllers, ensuring optimal performance. Consider a scenario where there are n controllers observing multiple resources in a cluster. If a separate cache is maintained for each controller, n caches will attempt to synchronize with the API Server, increasing the load on API Server. Instead, controller-runtime utilizes a shared cache called NewSharedIndexInformer for all controllers registered within a manager.\nIn the diagram above, two controllers maintain separate caches where both send ListAndWatch requests to API Server. However, controller-runtime utilizes a shared cache, reducing the need for multiple ListAndWatch operations.\nreference controller-runtime/pkg/cache/internal/informers.go\nCode Whether you use Kubebuilder, Operator SDK, or controller-runtime directly, operators necessitate a Manager to function. The NewManager from controller-runtime facilitates the creation of a new manager.\n1 2 3 4 5 6 var ( // Refer to godocs for details // .... // NewManager returns a new Manager for creating Controllers. NewManager = manager.New\t) Under the hood, NewManager calls New from the manager package.\n1 func New(config *rest.Config, options Options) (Manager, error) For a simple setup, we can create a new manager as follows\n1 2 3 4 5 6 7 8 9 10 11 12 13 import ( \"log\" ctrl \"sigs.k8s.io/controller-runtime\" \"sigs.k8s.io/controller-runtime/pkg/manager\" ) func main() { mgr, err := ctrl.NewManager(ctrl.GetConfigOrDie(), manager.Options{}) if err != nil { log.Fatal(err) } } Though this code piece is sufficient to create a Manager, the crucial part involves configuring the Manager using manager.Options{}.\nManager Options manager.Options{} configures various dependencies, such as webhooks, clients, or leader elections under the hood.\nScheme As mentioned in the godocs:\nScheme is the scheme used to resolve runtime.Objects to GroupVersionKinds / Resources.\nSo, scheme helps us to register your objects Go type into GVK. If you are building operators, you will realize following code block in your operator:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 package main import ( \"k8s.io/apimachinery/pkg/runtime\" runtimeschema \"k8s.io/apimachinery/pkg/runtime/schema\" utilruntime \"k8s.io/apimachinery/pkg/util/runtime\" \"sigs.k8s.io/controller-runtime/pkg/scheme\" ) var ( myscheme = runtime.NewScheme() // SchemeBuilder is used to add go types to the GroupVersionKind scheme SchemeBuilder = \u0026scheme.Builder{ GroupVersion: runtimeschema.GroupVersion{ Group: \"your.group\", Version: \"v1alpha1\", }, } ) func init() { // Adds your GVK to the scheme that you provided, which is myscheme in our case. utilruntime.Must(SchemeBuilder.AddToScheme(myscheme)) } Cache I mentioned cache a lot, but it is one of the most crucial piece of operators and controllers, where you can see its effect directly. As mentioned Controller Dependencies section, controller-runtime initializes NewSharedIndexInformer for our controllers under the hood. In order to configure cache, cache.Options{} needs to be utilized. There are again a couple of possible configurations possible but be careful while configuring your cache since it has an impact on performance and resource consumption of your operator.\nI specifically want to emphasize SyncPeriod and DefaultNamespaces\nSyncPeriod triggers reconciliation again for every object in the cache once the duration passes. By default, this is configured as 10 hours or so with some jitter across all controllers. Since running a reconciliation over all objects is quite expensive, be careful while adjusting this configuration.\nDefaultNamespaces configures caching objects in specified namespaces. For instance, to watch objects in prod namespace:\n1 2 3 4 5 manager.Options{ Cache: cache.Options{ DefaultNamespaces: map[string]cache.Config{\"prod\": cache.Config{}}, }, } Controller The Controller field, in manager.Options{}, configures essential options for controllers registered to this Manager. These options are set using controller.Options{}.\nNotably, the MaxConcurrentReconciles attribute within this configuration governs the number of concurrent reconciles allowed. As detailed in the Architecture of Controllers section, controllers run workers to execute reconciliation tasks. These workers operate as goroutines. By default, a controller uses only one goroutine, but this can be adjusted using the MaxConcurrentReconciles attribute.\nAfter configuring the Manager’s options, the NewManager function generates the controllerManager structure, which implements the Runnable interface.\nDuring the creation of the controllerManager structure, controller-runtime initializes the Cluster to handle all necessary operations to interact with your cluster, including managing clients and caches.\nAll the settings provided within manager.Options{} are transferred to cluster.New() to create the cluster. This process calls the private function newCache(restConfig *rest.Config, opts Options) newCacheFunc, initiating the NewInformer, which uses the type SharedIndexInformer as referenced in the Controller Dependencies section.\nThe next step involves registering controllers to the Manager.\n1 2 3 ctrl.NewControllerManagedBy(mgr). // 'mgr' refers to the controller-runtime Manager we've set up For(\u0026your.Object{}). // The 'For()' function takes the object your controller will reconcile Complete(r) // 'Complete' builds the controller and starts watching. I will dive into the detailed explanation of the controller registration process in my future writings to avoid making this post excessively long.\nReferences https://kubernetes.io/docs/concepts/architecture/controller/ ↩︎\nhttps://www.redhat.com/en/topics/containers/what-is-a-kubernetes-operator ↩︎\nhttps://github.com/kubernetes/sample-controller/blob/master/docs/controller-client-go.md ↩︎\nhttps://pkg.go.dev/sigs.k8s.io/controller-runtime/pkg/client ↩︎\n","wordCount":"1703","inLanguage":"en","datePublished":"2023-11-02T00:00:00Z","dateModified":"2023-11-02T00:00:00Z","author":{"@type":"Person","name":"Burak Sekili"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://buraksekili.github.io/articles/controller-runtime-1/"},"publisher":{"@type":"Organization","name":"Burak Sekili","logo":{"@type":"ImageObject","url":"https://buraksekili.github.io/images/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://buraksekili.github.io/ accesskey=h title="Burak Sekili (Alt + H)">Burak Sekili</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://buraksekili.github.io/archives/ title=Articles><span>Articles</span></a></li><li><a href=https://buraksekili.github.io/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://buraksekili.github.io/>Home</a>&nbsp;»&nbsp;<a href=https://buraksekili.github.io/articles/>Articles</a></div><h1 class=post-title>Diving into controller-runtime | Manager</h1><div class=post-description>Introduction to the Manager in `controller-runtime`</div><div class=post-meta><span title='2023-11-02 00:00:00 +0000 UTC'>November 2, 2023</span>&nbsp;·&nbsp;8 min&nbsp;·&nbsp;Burak Sekili</div></header><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#introduction aria-label=Introduction>Introduction</a></li><li><a href=#what-are-controllers-and-operators aria-label="What are Controllers and Operators?">What are Controllers and Operators?</a></li><li><a href=#the-architecture-of-controllers aria-label="The Architecture of Controllers">The Architecture of Controllers</a><ul><li><a href=#informer aria-label=Informer>Informer</a><ul><li><a href=#reflector aria-label=Reflector>Reflector</a></li><li><a href=#indexer aria-label=Indexer>Indexer</a></li></ul></li></ul></li><li><a href=#manager aria-label=Manager>Manager</a></li><li><a href=#controller-dependencies aria-label="Controller Dependencies">Controller Dependencies</a></li><li><a href=#code aria-label=Code>Code</a><ul><li><a href=#manager-options aria-label="Manager Options">Manager Options</a><ul><li><a href=#scheme aria-label=Scheme>Scheme</a></li><li><a href=#cache aria-label=Cache>Cache</a></li><li><a href=#controller aria-label=Controller>Controller</a></li></ul></li></ul></li><li><a href=#references aria-label=References>References</a></li></ul></div></details></div><div class=post-content><h2 id=introduction>Introduction<a hidden class=anchor aria-hidden=true href=#introduction>#</a></h2><p>The <code>controller-runtime</code> package has become a fundamental tool for most Kubernetes controllers, simplifying the creation
of controllers to manage resources within a Kubernetes environment efficiently. Users tend to prefer it over <code>client-go</code>.</p><p>The increased adoption of projects like Kubebuilder or Operator SDK has facilitated the creation of Kubernetes Operator projects.
Users need to implement minimal requirements to start with Kubernetes controllers, thanks to these projects.</p><p>As a developer working on Kubernetes projects, I inevitably touch code pieces utilizing <code>controller-runtime</code>.
Whenever I dive into code base, I always learn something new about the underlying mechanism of Kubernetes.</p><p>Through this blog series, I aim to share my learning regarding <code>controller-runtime</code>, consolidating my notes spread across various notebooks.</p><p>This article will specifically delve into the role of <code>controller-runtime</code>&rsquo;s Manager.</p><h2 id=what-are-controllers-and-operators>What are Controllers and Operators?<a hidden class=anchor aria-hidden=true href=#what-are-controllers-and-operators>#</a></h2><p><code>controller-runtime</code> has emerged as the go-to package for building Kubernetes controllers.
However, it is essential to understand what these controllers - or Kubernetes Operators - are.</p><p>In Kubernetes, controllers observe resources, such as Deployments, in a control loop to ensure the cluster resources
conform to the desired state specified in the resource specification (e.g., YAML files) <sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup>.</p><p>On the other hand, according to Redhat, a Kubernetes Operator is an application-specific controller <sup id=fnref:2><a href=#fn:2 class=footnote-ref role=doc-noteref>2</a></sup>. For instance,
the Prometheus Operator manages the lifecycle of a Prometheus instance in the cluster, including managing configurations
and updating Kubernetes resources, such as ConfigMaps.</p><p>Roughly both are quite similar. They provide a control loop to ensure the current state meets the desired state.</p><h2 id=the-architecture-of-controllers>The Architecture of Controllers<a hidden class=anchor aria-hidden=true href=#the-architecture-of-controllers>#</a></h2><p>Since controllers are in charge of meeting the desired state of the resources in Kubernetes, they somehow need to
be informed about the changes on the resources and perform certain operations if needed. For this, controllers follow
a special architecture to</p><ul><li>observe the resources,</li><li>inform any events (updating, deleting, adding) done on the resources,</li><li>keep a local cache to decrease the load on API Server,</li><li>keep a work queue to pick up events,</li><li>run workers to perform reconciliation on resources picked up from work queue.</li></ul><p>This architecture is clearly pictured in <code>client-go</code> documentation:
<img loading=lazy src=/images/controller-runtime-1-client-go-controller-interaction.jpeg alt=client-go-controller-interaction></p><blockquote><p>reference: <em>client-go documentation</em> <sup id=fnref:3><a href=#fn:3 class=footnote-ref role=doc-noteref>3</a></sup></p></blockquote><p>Most end-users typically do not need to interact with the sections outlined in blue in the architecture.
The <code>controller-runtime</code> effectively manages these elements. The subsequent section will explain these components
in simple terms.</p><p>To simply put, controllers use</p><ul><li>cache to prevent sending each getter request to API server,</li><li>workqueue which includes the key of the object that needs to be reconciled,</li><li>workers to process items reconciliation.</li></ul><h3 id=informer>Informer<a hidden class=anchor aria-hidden=true href=#informer>#</a></h3><p>Informers watch Kubernetes API server to detect changes in resources that we want to. It keeps a local cache - in-memory
cache implementing <a href=https://pkg.go.dev/k8s.io/client-go/tools/cache#Store>Store</a> interface -
including the objects observed through Kubernetes API. Then controllers and operators use this cache for all getter
requests - GET and LIST - to prevent load on Kubernetes API server. Moreover, Informers invoke controllers by sending
objects to the controllers (registering Event Handlers).</p><p>Informers leverage certain components like Reflector, Queue and Indexer, as shown in the above diagram.</p><h4 id=reflector>Reflector<a hidden class=anchor aria-hidden=true href=#reflector>#</a></h4><p>According to <a href=https://pkg.go.dev/sigs.k8s.io/controller-runtime/pkg/manager>godocs</a>:</p><blockquote><p>Reflector watches a specified resource and causes all changes to be reflected in the given store.</p></blockquote><p>The store is actually a cache - with two options; simple one and FIFO. Reflector pushes objects to Delta Fifo queue.</p><p>By monitoring the server (Kubernetes API Server), the Reflector maintains a local cache of the resources.
Upon any event occurring on the watched resource, implying a new operation on the Kubernetes resource,
the Reflector updates the cache (Delta FIFO queue, as illustrated in the diagram). Subsequently, the Informer reads
objects from this Delta FIFO queue, indexes them for future retrievals, and dispatches the object to the controller.</p><h4 id=indexer>Indexer<a hidden class=anchor aria-hidden=true href=#indexer>#</a></h4><p>Indexer saves objects into thread-safe Store by indexing the objects. This approach facilitates efficient querying of
objects from the cache.</p><p>Custom indexers, based on specific needs, can be created. For example, a custom indexer can be generated to retrieve all
objects based on certain fields, such as Annotations.</p><h2 id=manager>Manager<a hidden class=anchor aria-hidden=true href=#manager>#</a></h2><p>According to <a href=https://pkg.go.dev/sigs.k8s.io/controller-runtime/pkg/manager>godocs</a></p><blockquote><p>manager is required to create controllers and provides shared dependencies such as clients, caches, schemes,
etc. Controllers must be started by calling Manager.Start.</p></blockquote><p>The Manager serves as a crucial component for controllers by managing their operations. To put it simply, the manager
oversees one or more controllers that watch the resources (e.g., Pods) of interest.</p><p>Each operator requires a Manager to operate, as the Manager controls the controllers, webhooks, metric servers,
logs, leader elections, caches, and other components.</p><blockquote><p>For all dependencies managed by the Manager, please refer to the [Manager interface](<a href=https://pkg.go.dev/sigs.k8s.io/controller-runtime/pkg/manager#>https://pkg.go.dev/sigs.k8s.io/controller-runtime/pkg/manager#</a></p></blockquote><h2 id=controller-dependencies>Controller Dependencies<a hidden class=anchor aria-hidden=true href=#controller-dependencies>#</a></h2><p>As <a href=https://pkg.go.dev/sigs.k8s.io/controller-runtime/pkg/manager>godocs</a> mentioned, Manager provides shared dependencies such as clients, caches, schemes etc.
These dependencies are shared among the controllers managed by the Manager. If you have registered two controllers with
the Manager, these controllers will share common resources.</p><blockquote><p>Reconciliation, or the reconcile loop, involves the operators or controllers executing the business logic for the watched resources.
For example, a Deployment controller might create a specific number of Pods as specified in the Deployment spec.</p></blockquote><p>The Client package exposes functionalities to communicate with the Kubernetes API <sup id=fnref:4><a href=#fn:4 class=footnote-ref role=doc-noteref>4</a></sup>. Controllers, registered with a
specific Manager, utilize the same client to interact with the Kubernetes API. The main operations of the client include reading and writing.</p><p>Reading operations mostly utilize the cache to access the Kubernetes API, rather than accessing it directly,
to reduce the load on the Kubernetes API. In contrast, write operations directly communicate with the Kubernetes API.
However, this behavior can be modified so that read requests are directed to the Kubernetes API. Nevertheless, this is
generally not recommended unless there is a compelling reason to do so.</p><p>The cache is also shared across controllers, ensuring optimal performance. Consider a scenario where there are <em>n</em> controllers
observing multiple resources in a cluster. If a separate cache is maintained for each controller, <em>n</em> caches will attempt
to synchronize with the API Server, increasing the load on API Server. Instead, <code>controller-runtime</code> utilizes a shared cache
called <a href=https://pkg.go.dev/k8s.io/client-go@v0.28.3/tools/cache#NewSharedIndexInformer>NewSharedIndexInformer</a> for all
controllers registered within a manager.</p><p><img loading=lazy src=/images/controller-runtime-1-controller-cache.png alt=client-go-controller-interaction></p><p>In the diagram above, two controllers maintain separate caches where both send <code>ListAndWatch</code> requests to API Server.
However, <code>controller-runtime</code> utilizes a shared cache, reducing the need for multiple <code>ListAndWatch</code> operations.</p><p><img loading=lazy src=/images/controller-runtime-1-newsharedindexinformer.png alt=client-go-controller-interaction>
reference <a href=https://github.com/kubernetes-sigs/controller-runtime/blob/v0.16.3/pkg/cache/internal/informers.go#L56>controller-runtime/pkg/cache/internal/informers.go</a></p><h2 id=code>Code<a hidden class=anchor aria-hidden=true href=#code>#</a></h2><p>Whether you use Kubebuilder, Operator SDK, or <code>controller-runtime</code> directly, operators necessitate a Manager to function.
The <a href=https://pkg.go.dev/sigs.k8s.io/controller-runtime@v0.16.3#pkg-variables><code>NewManager</code></a> from <code>controller-runtime</code>
facilitates the creation of a new manager.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>var</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>	<span class=c1>// Refer to godocs for details
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=c1>// ....
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=c1>// NewManager returns a new Manager for creating Controllers.
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>NewManager</span> <span class=p>=</span> <span class=nx>manager</span><span class=p>.</span><span class=nx>New</span>	
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p>Under the hood, <a href=https://pkg.go.dev/sigs.k8s.io/controller-runtime@v0.16.3#pkg-variables><code>NewManager</code></a> calls
<a href=https://pkg.go.dev/sigs.k8s.io/controller-runtime@v0.16.3/pkg/manager#New><code>New</code></a> from the <code>manager</code> package.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>func</span> <span class=nf>New</span><span class=p>(</span><span class=nx>config</span> <span class=o>*</span><span class=nx>rest</span><span class=p>.</span><span class=nx>Config</span><span class=p>,</span> <span class=nx>options</span> <span class=nx>Options</span><span class=p>)</span> <span class=p>(</span><span class=nx>Manager</span><span class=p>,</span> <span class=kt>error</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p>For a simple setup, we can create a new manager as follows</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>import</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=s>&#34;log&#34;</span>
</span></span><span class=line><span class=cl>	
</span></span><span class=line><span class=cl>    <span class=nx>ctrl</span> <span class=s>&#34;sigs.k8s.io/controller-runtime&#34;</span>
</span></span><span class=line><span class=cl>    <span class=s>&#34;sigs.k8s.io/controller-runtime/pkg/manager&#34;</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>mgr</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>ctrl</span><span class=p>.</span><span class=nf>NewManager</span><span class=p>(</span><span class=nx>ctrl</span><span class=p>.</span><span class=nf>GetConfigOrDie</span><span class=p>(),</span> <span class=nx>manager</span><span class=p>.</span><span class=nx>Options</span><span class=p>{})</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>log</span><span class=p>.</span><span class=nf>Fatal</span><span class=p>(</span><span class=nx>err</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>Though this code piece is sufficient to create a Manager, the crucial part involves configuring the Manager
using <a href=https://pkg.go.dev/sigs.k8s.io/controller-runtime@v0.16.3/pkg/manager#Options><code>manager.Options{}</code></a>.</p><h3 id=manager-options>Manager Options<a hidden class=anchor aria-hidden=true href=#manager-options>#</a></h3><p><a href=https://pkg.go.dev/sigs.k8s.io/controller-runtime@v0.16.3/pkg/manager#Options><code>manager.Options{}</code></a> configures various
dependencies, such as webhooks, clients, or leader elections under the hood.</p><h4 id=scheme>Scheme<a hidden class=anchor aria-hidden=true href=#scheme>#</a></h4><p>As mentioned in the godocs:</p><blockquote><p>Scheme is the scheme used to resolve runtime.Objects to GroupVersionKinds / Resources.</p></blockquote><p>So, scheme helps us to register your objects Go type into GVK. If you are building operators, you will realize following
code block in your operator:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>package</span> <span class=nx>main</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=s>&#34;k8s.io/apimachinery/pkg/runtime&#34;</span>
</span></span><span class=line><span class=cl>    <span class=nx>runtimeschema</span> <span class=s>&#34;k8s.io/apimachinery/pkg/runtime/schema&#34;</span>
</span></span><span class=line><span class=cl>    <span class=nx>utilruntime</span> <span class=s>&#34;k8s.io/apimachinery/pkg/util/runtime&#34;</span>
</span></span><span class=line><span class=cl>    <span class=s>&#34;sigs.k8s.io/controller-runtime/pkg/scheme&#34;</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>var</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=nx>myscheme</span> <span class=p>=</span> <span class=nx>runtime</span><span class=p>.</span><span class=nf>NewScheme</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// SchemeBuilder is used to add go types to the GroupVersionKind scheme 
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>SchemeBuilder</span> <span class=p>=</span> <span class=o>&amp;</span><span class=nx>scheme</span><span class=p>.</span><span class=nx>Builder</span><span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>GroupVersion</span><span class=p>:</span> <span class=nx>runtimeschema</span><span class=p>.</span><span class=nx>GroupVersion</span><span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>Group</span><span class=p>:</span>   <span class=s>&#34;your.group&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nx>Version</span><span class=p>:</span> <span class=s>&#34;v1alpha1&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>init</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// Adds your GVK to the scheme that you provided, which is myscheme in our case.
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>utilruntime</span><span class=p>.</span><span class=nf>Must</span><span class=p>(</span><span class=nx>SchemeBuilder</span><span class=p>.</span><span class=nf>AddToScheme</span><span class=p>(</span><span class=nx>myscheme</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=cache>Cache<a hidden class=anchor aria-hidden=true href=#cache>#</a></h4><p>I mentioned cache a lot, but it is one of the most crucial piece of operators and controllers, where you can see its effect
directly.
As mentioned <a href=#controller-dependencies>Controller Dependencies</a> section, <code>controller-runtime</code> initializes <code>NewSharedIndexInformer</code>
for our controllers under the hood. In order to configure cache, <a href=https://pkg.go.dev/sigs.k8s.io/controller-runtime@v0.16.3/pkg/cache#Options><code>cache.Options{}</code></a>
needs to be utilized. There are again a couple of possible configurations possible but be careful while configuring
your cache since it has an impact on performance and resource consumption of your operator.</p><p>I specifically want to emphasize <code>SyncPeriod</code> and <code>DefaultNamespaces</code></p><p><code>SyncPeriod</code> triggers reconciliation again for every object in the cache once the duration passes.
By default, this is configured as 10 hours or so with some jitter across all controllers. Since running a reconciliation
over all objects is quite expensive, be careful while adjusting this configuration.</p><p><code>DefaultNamespaces</code> configures caching objects in specified namespaces. For instance, to watch objects in <code>prod</code> namespace:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=nx>manager</span><span class=p>.</span><span class=nx>Options</span><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>Cache</span><span class=p>:</span> <span class=nx>cache</span><span class=p>.</span><span class=nx>Options</span><span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>DefaultNamespaces</span><span class=p>:</span> <span class=kd>map</span><span class=p>[</span><span class=kt>string</span><span class=p>]</span><span class=nx>cache</span><span class=p>.</span><span class=nx>Config</span><span class=p>{</span><span class=s>&#34;prod&#34;</span><span class=p>:</span> <span class=nx>cache</span><span class=p>.</span><span class=nx>Config</span><span class=p>{}},</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=controller>Controller<a hidden class=anchor aria-hidden=true href=#controller>#</a></h4><p>The <code>Controller</code> field, in <code>manager.Options{}</code>, configures essential options for controllers registered to this Manager.
These options are set using <a href=https://pkg.go.dev/sigs.k8s.io/controller-runtime@v0.16.3/pkg/config#Controller><code>controller.Options{}</code></a>.</p><p>Notably, the <code>MaxConcurrentReconciles</code> attribute within this configuration governs the number of concurrent reconciles allowed.
As detailed in the <a href=#the-architecture-of-controllers>Architecture of Controllers</a> section,
controllers run workers to execute reconciliation tasks. These workers operate as <code>goroutines</code>.
By default, a controller uses only one goroutine, but this can be adjusted using the <code>MaxConcurrentReconciles</code> attribute.</p><hr><p>After configuring the Manager&rsquo;s options, the <a href=https://github.com/kubernetes-sigs/controller-runtime/blob/v0.16.3/pkg/manager/manager.go#L315><code>NewManager</code></a>
function generates the <a href=https://github.com/kubernetes-sigs/controller-runtime/blob/main/pkg/manager/internal.go#L63><code>controllerManager</code></a> structure,
which implements the <a href=https://pkg.go.dev/sigs.k8s.io/controller-runtime@v0.16.3/pkg/manager#Runnable><code>Runnable</code></a> interface.</p><p>During the creation of the <a href=https://github.com/kubernetes-sigs/controller-runtime/blob/main/pkg/manager/internal.go#L63><code>controllerManager</code></a>
structure, <code>controller-runtime</code> initializes the <a href=https://pkg.go.dev/sigs.k8s.io/controller-runtime@v0.16.3/pkg/cluster#Cluster><code>Cluster</code></a>
to handle all necessary operations to interact with your cluster, including managing clients and caches.</p><p>All the settings provided within <a href=https://pkg.go.dev/sigs.k8s.io/controller-runtime@v0.16.3/pkg/manager#Options><code>manager.Options{}</code></a>
are transferred to <a href=https://github.com/kubernetes-sigs/controller-runtime/blob/v0.16.3/pkg/manager/manager.go#L322><code>cluster.New()</code></a>
to create the cluster.
This process calls the private function <a href=https://github.com/kubernetes-sigs/controller-runtime/blob/v0.16.3/pkg/cache/cache.go#L300><code>newCache(restConfig *rest.Config, opts Options) newCacheFunc</code></a>,
initiating the <a href=https://github.com/kubernetes-sigs/controller-runtime/blob/v0.16.3/pkg/cache/cache.go#L361><code>NewInformer</code></a>,
which uses the type <a href=https://github.com/kubernetes-sigs/controller-runtime/blob/v0.16.3/pkg/cache/internal/informers.go#L56>SharedIndexInformer</a>
as referenced in the <a href=#controller-dependencies>Controller Dependencies</a> section.</p><p>The next step involves registering controllers to the Manager.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=nx>ctrl</span><span class=p>.</span><span class=nf>NewControllerManagedBy</span><span class=p>(</span><span class=nx>mgr</span><span class=p>).</span> <span class=c1>// &#39;mgr&#39; refers to the controller-runtime Manager we&#39;ve set up
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nf>For</span><span class=p>(</span><span class=o>&amp;</span><span class=nx>your</span><span class=p>.</span><span class=nx>Object</span><span class=p>{}).</span> <span class=c1>// The &#39;For()&#39; function takes the object your controller will reconcile
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nf>Complete</span><span class=p>(</span><span class=nx>r</span><span class=p>)</span> <span class=c1>// &#39;Complete&#39; builds the controller and starts watching.
</span></span></span></code></pre></td></tr></table></div></div><p>I will dive into the detailed explanation of the controller registration process in my future writings to avoid making this post excessively long.</p><h2 id=references>References<a hidden class=anchor aria-hidden=true href=#references>#</a></h2><div class=footnotes role=doc-endnotes><hr><ol><li id=fn:1><p><a href=https://kubernetes.io/docs/concepts/architecture/controller/>https://kubernetes.io/docs/concepts/architecture/controller/</a>&#160;<a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:2><p><a href=https://www.redhat.com/en/topics/containers/what-is-a-kubernetes-operator>https://www.redhat.com/en/topics/containers/what-is-a-kubernetes-operator</a>&#160;<a href=#fnref:2 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:3><p><a href=https://github.com/kubernetes/sample-controller/blob/master/docs/controller-client-go.md>https://github.com/kubernetes/sample-controller/blob/master/docs/controller-client-go.md</a>&#160;<a href=#fnref:3 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:4><p><a href=https://pkg.go.dev/sigs.k8s.io/controller-runtime/pkg/client>https://pkg.go.dev/sigs.k8s.io/controller-runtime/pkg/client</a>&#160;<a href=#fnref:4 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li></ol></div></div><footer class=post-footer><ul class=post-tags><li><a href=https://buraksekili.github.io/tags/kubernetes/>Kubernetes</a></li><li><a href=https://buraksekili.github.io/tags/operator/>Operator</a></li><li><a href=https://buraksekili.github.io/tags/controller-runtime/>controller-runtime</a></li></ul><div class=share-buttons><a target=_blank rel="noopener noreferrer" aria-label="share Diving into controller-runtime | Manager on twitter" href="https://twitter.com/intent/tweet/?text=Diving%20into%20controller-runtime%20%7c%20Manager&amp;url=https%3a%2f%2fburaksekili.github.io%2farticles%2fcontroller-runtime-1%2f&amp;hashtags=Kubernetes%2cOperator%2ccontroller-runtime"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM195.519 424.544c135.939.0 210.268-112.643 210.268-210.268.0-3.218.0-6.437-.153-9.502 14.406-10.421 26.973-23.448 36.935-38.314-13.18 5.824-27.433 9.809-42.452 11.648 15.326-9.196 26.973-23.602 32.49-40.92-14.252 8.429-30.038 14.56-46.896 17.931-13.487-14.406-32.644-23.295-53.946-23.295-40.767.0-73.87 33.104-73.87 73.87.0 5.824.613 11.494 1.992 16.858-61.456-3.065-115.862-32.49-152.337-77.241-6.284 10.881-9.962 23.601-9.962 37.088.0 25.594 13.027 48.276 32.95 61.456-12.107-.307-23.448-3.678-33.41-9.196v.92c0 35.862 25.441 65.594 59.311 72.49-6.13 1.686-12.72 2.606-19.464 2.606-4.751.0-9.348-.46-13.946-1.38 9.349 29.426 36.628 50.728 68.965 51.341-25.287 19.771-57.164 31.571-91.8 31.571-5.977.0-11.801-.306-17.625-1.073 32.337 21.15 71.264 33.41 112.95 33.41z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Diving into controller-runtime | Manager on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fburaksekili.github.io%2farticles%2fcontroller-runtime-1%2f&amp;title=Diving%20into%20controller-runtime%20%7c%20Manager&amp;summary=Diving%20into%20controller-runtime%20%7c%20Manager&amp;source=https%3a%2f%2fburaksekili.github.io%2farticles%2fcontroller-runtime-1%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Diving into controller-runtime | Manager on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fburaksekili.github.io%2farticles%2fcontroller-runtime-1%2f&title=Diving%20into%20controller-runtime%20%7c%20Manager"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Diving into controller-runtime | Manager on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fburaksekili.github.io%2farticles%2fcontroller-runtime-1%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Diving into controller-runtime | Manager on whatsapp" href="https://api.whatsapp.com/send?text=Diving%20into%20controller-runtime%20%7c%20Manager%20-%20https%3a%2f%2fburaksekili.github.io%2farticles%2fcontroller-runtime-1%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Diving into controller-runtime | Manager on telegram" href="https://telegram.me/share/url?text=Diving%20into%20controller-runtime%20%7c%20Manager&amp;url=https%3a%2f%2fburaksekili.github.io%2farticles%2fcontroller-runtime-1%2f"><svg viewBox="2 2 28 28" height="30" width="30" fill="currentcolor"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Diving into controller-runtime | Manager on ycombinator" href="https://news.ycombinator.com/submitlink?t=Diving%20into%20controller-runtime%20%7c%20Manager&u=https%3a%2f%2fburaksekili.github.io%2farticles%2fcontroller-runtime-1%2f"><svg width="30" height="30" viewBox="0 0 512 512" fill="currentcolor" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"><path d="M449.446.0C483.971.0 512 28.03 512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446zM183.8767 87.9921h-62.034L230.6673 292.4508V424.0079h50.6655V292.4508L390.1575 87.9921H328.1233L256 238.2489z"/></svg></a></div></footer></article></main><footer class=footer><span>&copy; 2023 <a href=https://buraksekili.github.io/>Burak Sekili</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>